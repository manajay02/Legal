<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Argument Critic - Test Frontend</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: border 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            width: 100%;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        input[type="file"] {
            display: none;
        }

        .file-name {
            margin-top: 10px;
            color: #667eea;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            width: 100%;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            margin-top: 30px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-card h2 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .strength-label {
            font-size: 1.5em;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-weight: 600;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .category-name {
            font-weight: 600;
            color: #333;
        }

        .category-score {
            color: #667eea;
            font-weight: 600;
        }

        .category-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .category-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease-out;
        }

        .category-rationale {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .feedback-section {
            background: #fff9e6;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }

        .feedback-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .feedback-section ul {
            list-style: none;
        }

        .feedback-section li {
            padding: 10px 0;
            border-bottom: 1px solid #f0e6c4;
        }

        .feedback-section li:last-child {
            border-bottom: none;
        }

        .feedback-section li:before {
            content: "üí° ";
            margin-right: 10px;
        }

        .weaknesses-section {
            background: #ffe6e6;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #f44336;
        }

        .weaknesses-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .weaknesses-section ul {
            list-style: none;
        }

        .weaknesses-section li {
            padding: 10px 0;
            border-bottom: 1px solid #f0c4c4;
        }

        .weaknesses-section li:last-child {
            border-bottom: none;
        }

        .weaknesses-section li:before {
            content: "‚ö†Ô∏è ";
            margin-right: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #c62828;
            margin-top: 20px;
        }

        .char-count {
            text-align: right;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .api-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .api-status.online {
            background: #4caf50;
            color: white;
        }

        .api-status.offline {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Legal Argument Critic</h1>
            <p>AI-Powered Legal Argument Analysis for Sri Lankan Civil Cases</p>
            <div id="apiStatus"></div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('text')">üìù Analyze Text</button>
            <button class="tab" onclick="switchTab('file')">üìÑ Upload File</button>
        </div>

        <!-- Text Analysis Tab -->
        <div id="textTab" class="tab-content active">
            <div class="input-group">
                <label for="argumentText">Enter Legal Argument (50-10,000 characters)</label>
                <textarea 
                    id="argumentText" 
                    rows="10" 
                    placeholder="Paste your legal argument here. Include facts, legal basis, evidence, and reasoning...

Example: The appellant challenges the District Court's decision on grounds of procedural irregularity. The lower court failed to consider Section 91 of the Civil Procedure Code which mandates proper notice to all parties. On July 15, 2023, the respondent filed an ex parte motion without providing adequate notice to the appellant..."
                    oninput="updateCharCount()"></textarea>
                <div class="char-count" id="charCount">0 / 10,000 characters</div>
            </div>
            <button class="btn" onclick="analyzeText()" id="analyzeBtn">Analyze Argument</button>
            <div id="textResults"></div>
        </div>

        <!-- File Upload Tab -->
        <div id="fileTab" class="tab-content">
            <div class="input-group">
                <label>Upload PDF or TXT File (Max 10MB)</label>
                <div class="file-input-wrapper">
                    <label for="fileInput" class="file-input">
                        <div>üìÅ Click to select file</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 10px;">Accepts: .pdf, .txt</div>
                    </label>
                    <input type="file" id="fileInput" accept=".pdf,.txt" onchange="handleFileSelect()">
                </div>
                <div class="file-name" id="fileName"></div>
            </div>
            <button class="btn" onclick="uploadFile()" id="uploadBtn" disabled>Upload & Analyze</button>
            <div id="fileResults"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let selectedFile = null;

        // Check API status on load
        window.onload = async () => {
            await checkAPIStatus();
        };

        async function checkAPIStatus() {
            const statusEl = document.getElementById('apiStatus');
            try {
                const response = await fetch(`${API_URL}/api/v1/health`);
                if (response.ok) {
                    statusEl.innerHTML = '<span class="api-status online">‚úì API Online</span>';
                } else {
                    statusEl.innerHTML = '<span class="api-status offline">‚úó API Offline</span>';
                }
            } catch (error) {
                statusEl.innerHTML = '<span class="api-status offline">‚úó API Offline - Start server with: python -m uvicorn app.main:app --reload</span>';
            }
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            if (tab === 'text') {
                document.getElementById('textTab').classList.add('active');
            } else {
                document.getElementById('fileTab').classList.add('active');
            }
        }

        function updateCharCount() {
            const text = document.getElementById('argumentText').value;
            const count = text.length;
            const countEl = document.getElementById('charCount');
            countEl.textContent = `${count} / 10,000 characters`;
            
            if (count < 50) {
                countEl.style.color = '#f44336';
            } else if (count > 10000) {
                countEl.style.color = '#f44336';
            } else {
                countEl.style.color = '#4caf50';
            }
        }

        function handleFileSelect() {
            const input = document.getElementById('fileInput');
            const fileNameEl = document.getElementById('fileName');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (input.files.length > 0) {
                selectedFile = input.files[0];
                fileNameEl.textContent = `Selected: ${selectedFile.name} (${(selectedFile.size / 1024 / 1024).toFixed(2)} MB)`;
                uploadBtn.disabled = false;
            }
        }

        async function analyzeText() {
            const text = document.getElementById('argumentText').value;
            const resultsEl = document.getElementById('textResults');
            const btn = document.getElementById('analyzeBtn');

            // Validation
            if (text.length < 50) {
                resultsEl.innerHTML = '<div class="error">‚ùå Text must be at least 50 characters long</div>';
                return;
            }
            if (text.length > 10000) {
                resultsEl.innerHTML = '<div class="error">‚ùå Text must not exceed 10,000 characters</div>';
                return;
            }

            // Show loading
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            resultsEl.innerHTML = '<div class="loading"><div class="spinner"></div><p>Analyzing your argument... This may take 10-30 seconds.</p></div>';

            try {
                const response = await fetch(`${API_URL}/api/v1/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data, resultsEl);
            } catch (error) {
                resultsEl.innerHTML = `<div class="error">‚ùå Error: ${error.message}<br><br>Make sure the API server is running on port 8000.</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Analyze Argument';
            }
        }

        async function uploadFile() {
            if (!selectedFile) return;

            const resultsEl = document.getElementById('fileResults');
            const btn = document.getElementById('uploadBtn');

            // Show loading
            btn.disabled = true;
            btn.textContent = 'Uploading...';
            resultsEl.innerHTML = '<div class="loading"><div class="spinner"></div><p>Uploading and analyzing file... This may take 20-60 seconds.</p></div>';

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch(`${API_URL}/api/v1/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data, resultsEl, true);
            } catch (error) {
                resultsEl.innerHTML = `<div class="error">‚ùå Error: ${error.message}<br><br>Make sure the API server is running on port 8000.</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Upload & Analyze';
            }
        }

        function displayResults(data, container, isFile = false) {
            const weakCategories = data.breakdown.filter(cat => cat.rubric_score < 3);
            
            let html = `
                <div class="results">
                    <div class="score-card">
                        <h2>${data.overall_score}/100</h2>
                        <div class="strength-label">${data.strength_label}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${data.overall_score}%;">
                                ${data.overall_score}%
                            </div>
                        </div>
                    </div>
            `;

            if (isFile && data.filename) {
                html += `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üìÑ File:</strong> ${data.filename}<br>
                        <strong>üìù Length:</strong> ${data.text_length} characters
                    </div>
                `;
            }

            // Category Breakdown
            html += '<h3 style="margin-bottom: 20px;"> Category Breakdown</h3><div class="category-grid">';
            data.breakdown.forEach(category => {
                const percentage = (category.rubric_score / 5) * 100;
                html += `
                    <div class="category-card">
                        <div class="category-header">
                            <span class="category-name">${category.category}</span>
                            <span class="category-score">${category.rubric_score}/5</span>
                        </div>
                        <div class="category-bar">
                            <div class="category-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="category-rationale">${category.rationale}</div>
                    </div>
                `;
            });
            html += '</div>';

            // Suggestions
            if (data.feedback && data.feedback.length > 0) {
                html += `
                    <div class="feedback-section">
                        <h3>üí° Suggestions for Improvement</h3>
                        <ul>
                            ${data.feedback.map(suggestion => `<li>${suggestion}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // Weaknesses
            if (weakCategories.length > 0) {
                html += `
                    <div class="weaknesses-section">
                        <h3>‚ö†Ô∏è Areas Needing Attention</h3>
                        <ul>
                            ${weakCategories.map(cat => `
                                <li><strong>${cat.category}:</strong> ${cat.rationale}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
        }
    </script>
</body>
</html>
