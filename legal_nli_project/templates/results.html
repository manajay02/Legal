<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance Analysis Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">Legal Compliance Analyzer</a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Back Link -->
        <a href="/" class="back-link">Analyze Another Document</a>

        <!-- Results Header -->
        <div class="results-container">
            <div class="results-header">
                <h2>üìä Compliance Analysis Results</h2>
                {% if domain %}
                    <span class="domain-badge">Domain: {{ domain }}</span>
                {% endif %}
            </div>

            <!-- Enhanced Summary Section with Border -->
            <div class="summary-section">
                <div class="summary-header">
                    <h3>üìä Analysis Summary</h3>
                    <span class="summary-subtitle">Comprehensive overview of compliance analysis</span>
                </div>
                <div class="summary-stats">
                    <div class="stat-card stat-total">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-value">{{ results | length }}</div>
                        <div class="stat-label">Total Clauses Analyzed</div>
                    </div>
                    <div class="stat-card stat-compliant">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value">
                            {% set compliant = results | selectattr('nli_label', 'equalto', 'ENTAILMENT') | list | length %}
                            {{ compliant }}
                        </div>
                        <div class="stat-label">Compliant Clauses</div>
                        <div class="stat-percentage">
                            {% if results | length > 0 %}
                                {{ "%.1f" | format((compliant / (results | length)) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                    </div>
                    <div class="stat-card stat-non-compliant">
                        <div class="stat-icon">‚ùå</div>
                        <div class="stat-value">
                            {% set contradictory = results | selectattr('nli_label', 'equalto', 'CONTRADICTION') | list | length %}
                            {{ contradictory }}
                        </div>
                        <div class="stat-label">Non-Compliant</div>
                        <div class="stat-percentage">
                            {% if results | length > 0 %}
                                {{ "%.1f" | format((contradictory / (results | length)) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                    </div>
                    <div class="stat-card stat-review">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-value">
                            {% set neutral = results | selectattr('nli_label', 'equalto', 'NEUTRAL') | list | length %}
                            {{ neutral }}
                        </div>
                        <div class="stat-label">Requires Review</div>
                        <div class="stat-percentage">
                            {% if results | length > 0 %}
                                {{ "%.1f" | format((neutral / (results | length)) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            

            <!-- Check if results exist -->
            {% if results %}
                <!-- Results Grid -->
                {% for result in results %}
                    <div class="result-card {% if result.nli_label == 'CONTRADICTION' %}contradiction{% elif result.nli_label == 'ENTAILMENT' %}entailment{% else %}neutral{% endif %}">
                        
                        <!-- Status Badge -->
                        <div class="result-status">
                            {% if result.nli_label == 'CONTRADICTION' %}
                                <span class="status-badge contradiction">CONTRADICTION</span>
                            {% elif result.nli_label == 'ENTAILMENT' %} 
                                <span class="status-badge entailment">ENTAILMENT</span>
                            {% else %}
                                <span class="status-badge neutral">NEUTRAL</span>
                            {% endif %}
                        </div>

                        <!-- Clause Text -->
                        <div class="clause-text">
                            <strong>üìù Clause:</strong><br>
                            {{ result.contract_clause }}
                        </div>

                        <!-- Result Details -->
                        <div class="result-details">
                            <div class="detail-item">
                                <label>‚öñÔ∏è Law Reference</label>
                                <p>{{ result.law_reference }}</p>
                            </div>

                            <div class="detail-item">
                                <label>‚úì Status</label>
                                <p>{{ result.status }}</p>
                            </div>

                            <div class="detail-item">
                                <label>üìä Confidence Score</label>
                                <div class="confidence-score-wrapper">
                                    <span class="confidence-value">{{ "%.1f" | format(result.confidence * 100) }}%</span>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar {% if result.confidence >= 0.8 %}high-confidence{% elif result.confidence >= 0.5 %}medium-confidence{% else %}low-confidence{% endif %}" 
                                             style="width: {{ result.confidence * 100 }}%;">
                                            <span class="progress-bar-text">{{ "%.1f" | format(result.confidence * 100) }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-item">
                                <label>üè∑Ô∏è Category</label>
                                <p>
                                    {% if result.nli_label == 'CONTRADICTION' %}
                                        <span style="color: #ef4444; font-weight: 600;">Non-Compliant</span>
                                    {% elif result.nli_label == 'ENTAILMENT' %}
                                        <span style="color: #10b981; font-weight: 600;">Compliant</span>
                                    {% else %}
                                        <span style="color: #f59e0b; font-weight: 600;">Review Needed</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>

                        <!-- Explanation -->
                        <div class="explanation">
                            <label>üí° Analysis & Recommendation</label>
                            <p>{{ result.explanation }}</p>
                        </div>
                    </div>
                {% endfor %}

            {% else %}
                <!-- No Results Message -->
                <div class="no-results">
                    <p>No matching laws or clauses were found for the uploaded document.</p>
                    <p style="margin-top: 1rem; font-size: 0.95rem;">This could mean the document type or content is outside the current knowledge base.</p>
                </div>
            {% endif %}
        </div>

        <!-- Action Buttons -->
        <div style="text-align: center; margin-top: 2rem; margin-bottom: 2rem;">
            <a href="/" class="btn btn-primary">
                ‚Üê Analyze Another Document
            </a>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>üîí Secure analysis | üöÄ Powered by Legal NLI Model | ‚öñÔ∏è Legal Compliance Analyzer</p>
    </div>
</body>
</html>
